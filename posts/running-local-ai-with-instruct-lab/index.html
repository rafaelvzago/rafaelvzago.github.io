<!doctype html><html lang="pt-BR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Running local AI with Instruct Lab and Skupper" /><meta property="og:locale" content="pt_BR" /><meta name="description" content="Welcome to the Ollama Pilot." /><meta property="og:description" content="Welcome to the Ollama Pilot." /><link rel="canonical" href="https://rafaelvzago.github.io/posts/running-local-ai-with-instruct-lab/" /><meta property="og:url" content="https://rafaelvzago.github.io/posts/running-local-ai-with-instruct-lab/" /><meta property="og:site_name" content="Rafael Zago" /><meta property="og:image" content="https://rafaelvzago.github.io/assets/img/headers/instructlab_workshop-skupper-patient-portal.jpg" /><meta property="og:image:alt" content="Instructlab with Skupper" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-08-01T00:00:00-03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://rafaelvzago.github.io/assets/img/headers/instructlab_workshop-skupper-patient-portal.jpg" /><meta name="twitter:image:alt" content="Instructlab with Skupper" /><meta property="twitter:title" content="Running local AI with Instruct Lab and Skupper" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-08-01T00:00:00-03:00","datePublished":"2024-08-01T00:00:00-03:00","description":"Welcome to the Ollama Pilot.","headline":"Running local AI with Instruct Lab and Skupper","image":{"alt":"Instructlab with Skupper","url":"https://rafaelvzago.github.io/assets/img/headers/instructlab_workshop-skupper-patient-portal.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rafaelvzago.github.io/posts/running-local-ai-with-instruct-lab/"},"url":"https://rafaelvzago.github.io/posts/running-local-ai-with-instruct-lab/"}</script><title>Running local AI with Instruct Lab and Skupper | Rafael Zago</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rafael Zago"><meta name="application-name" content="Rafael Zago"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="preconnect" href="https://cdnjs.cloudflare.com" ><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://gravatar.com/userimage/75121319/3dc8bb7e7befedea878842edafcb1335.jpeg?size=256" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Rafael Zago</a></h1><p class="site-subtitle fst-italic mb-0">Meu bloco de notas na interwebs..</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARQUIVOS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>SOBRE</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/rafaevzago" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Running local AI with Instruct Lab and Skupper</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancelar</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Running local AI with Instruct Lab and Skupper</h1><div class="post-meta text-muted"> <span> Postado em <time data-ts="1722481200" data-df="DD/MM/YYYY" data-bs-toggle="tooltip" data-bs-placement="bottom" > 01/08/2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/img/headers/instructlab_workshop-skupper-patient-portal.jpg" class="popup img-link preview-img shimmer"><img src="/assets/img/headers/instructlab_workshop-skupper-patient-portal.jpg" alt="Instructlab with Skupper" width="1200" height="630" loading="lazy"></a><figcaption class="text-center pt-2 pb-2">Instructlab with Skupper</figcaption></div><div class="d-flex justify-content-between"> <span> Por <em> <a href="https://github.com/rafaelvzago">Rafael Zago</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1591 palavras" > <em>8 min</em> de leitura</span></div></div></header><div class="content"><h1 id="welcome-to-the-ollama-pilot">Welcome to the Ollama Pilot.</h1><h2 id="problem-to-solve"><span class="me-2">Problem to solve</span><a href="#problem-to-solve" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/instructlab_banner.jpg" class="popup img-link shimmer"><img src="/assets/instructlab_banner.jpg" alt="contest" loading="lazy"></a></p><p>The main goal of this project is to create a secure connection between two sites, enabling the communication between the engineer machine and an Instruct Lab Model. The merlinite-7b-lab-Q4_K_M.gguf model will be used for the chatbot, and it is available in the Instruct Lab. The license of the model is available in the <a href="https://instructlab.ai/">Instruct Labs</a>.</p><p>But, why the banner? Well, the engineer needs to know who is better, Lebron or Jordan. The chatbot will be responsible for answering this question. The chatbot will receive the user input and send it to the llama3 model. The response from the merlinite model will be sent back to the user.</p><h2 id="disclaimer"><span class="me-2">Disclaimer</span><a href="#disclaimer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote><p>All the models used are available in the Hugging Face model hub. The models are not hosted in this project, they are hosted by Hugging Face. The models are used for educational purposes only.</p></blockquote><h2 id="why-instructlab"><span class="me-2">Why InstructLab</span><a href="#why-instructlab" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>There are many projects rapidly embracing and extending permissively licensed AI models, but they are faced with three main challenges:</p><ul><li>Contribution to LLMs is not possible directly. They show up as forks, which forces consumers to choose a “best-fit” model that isn’t easily extensible. Also, the forks are expensive for model creators to maintain.<li>The ability to contribute ideas is limited by a lack of AI/ML expertise. One has to learn how to fork, train, and refine models to see their idea move forward. This is a high barrier to entry.<li>There is no direct community governance or best practice around review, curation, and distribution of forked models.</ul><p>This snippet was extracted from the <a href="https://github.com/instructlab">Instruct Labs</a> repository.</p><h2 id="why-skupper"><span class="me-2">Why Skupper</span><a href="#why-skupper" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/instructlab_skupper.png" class="popup img-link shimmer"><img src="/assets/instructlab_skupper.png" alt="Skupper" loading="lazy"></a></p><p>Here the answer is simple, Skupper is a tool that enables secure communication between services in different environments. Skupper will be used to create a secure connection between the two sites, one of the sites has restricted access to the internet. Skupper will enable the communication between the two sites, allowing the Ollama Pilot application to send requests to the llama3 model thru the Instruct Lab chat.</p><h2 id="description"><span class="me-2">Description</span><a href="#description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This project has the objective to create a VAN (Virtual Application Network) that enables the connection between two sites:</p><ul><li><p>Site A: A server that hosts the Instruct Lab chat model. This model will be responsible for receiving the user input and sending it to the llama3 model. The response from the llama3 model will be sent back to the user.</p><li><p>Site B: An OpenShift site that exposes the Instruct Lab chat model. This site will be responsible for sending the user input to the Instruct Lab chat model and receiving the response from the Merlinite-7b-lab-Q4_K_M.gguf model.</p></ul><p>In order to connect the two sites, we will use <a href="https://skupper.io/">Skupper</a>, a tool that enables secure communication between services in different environments. Skupper will be used to create a secure connection between the two sites, allowing the Ollama Pilot application to send requests to the llama3 model and receive the response from the merlinite model.</p><p>At the end of the project, you will be able to use your own CHATBOT with protected data.</p><h2 id="architecture"><span class="me-2">Architecture</span><a href="#architecture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/instructlab_architecture.png" class="popup img-link shimmer"><img src="/assets/instructlab_architecture.png" alt="Architecture" loading="lazy"></a></p><h2 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>AI model deployment with InstructLab<li>Private Skupper deployment<li>Public Skupper deployment<li>Secure communication between the two sites with Skupper<li>Chatbot with protected data</ol><h2 id="1-ai-model-deployment-with-instructlab"><span class="me-2">1. AI model deployment with InstructLab</span><a href="#1-ai-model-deployment-with-instructlab" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The first step is to deploy the InstructLab chat model in the InstructLab site. The InstructLab chat model will be responsible for receiving the user input and sending it to the llama3 model. The response from the llama3 model will be sent back to the user. This is based on the article: <a href="https://developers.redhat.com/blog/2024/06/12/getting-started-instructlab-generative-ai-model-tuning#model_alignment_and_training_with_instructlab">Getting started with InstructLab for generative AI model tuning</a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>instructlab <span class="o">&amp;&amp;</span> <span class="nb">cd </span>instructlab 
python3.11 <span class="nt">-m</span> venv venv 
<span class="nb">source </span>venv/bin/activate
pip <span class="nb">install</span> <span class="s1">'instructlab[cuda]'</span> <span class="nt">-C</span> cmake.args<span class="o">=</span><span class="s2">"-DLLAMA_CUDA=on"</span> <span class="nt">-C</span> cmake.args<span class="o">=</span><span class="s2">"-DLLAMA_NATIVE=off"</span>
</pre></table></code></div></div><blockquote><p>IMPORTANT: This installation method will enable your Nvidia GPU to be used by instructlab. If you don’t have an Nvidia GPU, please check other options in: <a href="https://github.com/instructlab/instructlab/blob/main/README.md#-installing-ilab">InstructLab 🐶 (ilab)</a></p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ilab config init
</pre></table></code></div></div><p>To enable external access to your model, please modify the <code class="language-plaintext highlighter-rouge">config.yaml</code> file:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="na">chat</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">greedy_mode</span><span class="pi">:</span> <span class="kc">false</span>
  <span class="na">logs_dir</span><span class="pi">:</span> <span class="s">data/chatlogs</span>
  <span class="na">max_tokens</span><span class="pi">:</span> <span class="kc">null</span>
  <span class="na">model</span><span class="pi">:</span> <span class="s">models/merlinite-7b-lab-Q4_K_M.gguf</span>
  <span class="na">session</span><span class="pi">:</span> <span class="kc">null</span>
  <span class="na">vi_mode</span><span class="pi">:</span> <span class="kc">false</span>
  <span class="na">visible_overflow</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">general</span><span class="pi">:</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">INFO</span>
<span class="na">generate</span><span class="pi">:</span>
  <span class="na">chunk_word_count</span><span class="pi">:</span> <span class="m">1000</span>
  <span class="na">model</span><span class="pi">:</span> <span class="s">models/merlinite-7b-lab-Q4_K_M.gguf</span>
  <span class="na">num_cpus</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">num_instructions</span><span class="pi">:</span> <span class="m">100</span>
  <span class="na">output_dir</span><span class="pi">:</span> <span class="s">generated</span>
  <span class="na">prompt_file</span><span class="pi">:</span> <span class="s">prompt.txt</span>
  <span class="na">seed_file</span><span class="pi">:</span> <span class="s">seed_tasks.json</span>
  <span class="na">taxonomy_base</span><span class="pi">:</span> <span class="s">origin/main</span>
  <span class="na">taxonomy_path</span><span class="pi">:</span> <span class="s">taxonomy</span>
<span class="na">serve</span><span class="pi">:</span>
  <span class="na">gpu_layers</span><span class="pi">:</span> <span class="s">-1</span>
  <span class="na">host_port</span><span class="pi">:</span> <span class="s">0.0.0.0:8000</span> <span class="c1"># HERE</span>
  <span class="na">max_ctx_size</span><span class="pi">:</span> <span class="m">4096</span>
  <span class="na">model_path</span><span class="pi">:</span> <span class="s">models/merlinite-7b-lab-Q4_K_M.gguf</span>
</pre></table></code></div></div><p>Now, you can download and start your server:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>ilab model download
ilab model serve

<span class="c"># The output should be similar to:</span>
INFO 2024-07-30 18:59:01,199 serve.py:51: serve Using model <span class="s1">'models/merlinite-7b-lab-Q4_K_M.gguf'</span> with <span class="nt">-1</span> gpu-layers and 4096 max context size.
INFO 2024-07-30 18:59:01,611 server.py:218: server Starting server process, press CTRL+C to shutdown server...
INFO 2024-07-30 18:59:01,612 server.py:219: server After application startup <span class="nb">complete </span>see http://0.0.0.0:8000/docs <span class="k">for </span>API.
</pre></table></code></div></div><h2 id="2-private-skupper-deployment"><span class="me-2">2. Private Skupper deployment</span><a href="#2-private-skupper-deployment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The second step is to deploy the private Skupper in Site A. The private Skupper will be responsible for creating a secure connection between the two sites, allowing the Ollama Pilot application to send requests to the llama3 model and receive the response from the merlinite model. Open a new terminal and run the following commands:</p><h3 id="install-skupper"><span class="me-2">Install Skupper</span><a href="#install-skupper" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">SKUPPER_PLATFORM</span><span class="o">=</span>podman
skupper init <span class="nt">--ingress</span> none
</pre></table></code></div></div><h3 id="exposing-the-instructlab-chat-model"><span class="me-2">Exposing the InstructLab chat model</span><a href="#exposing-the-instructlab-chat-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In order to do this, we will bind the local service that is running the InstructLab chat model to the Skupper service.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>skupper expose host host.containers.internal <span class="nt">--address</span> instructlab <span class="nt">--port</span> 8000
</pre></table></code></div></div><p>Let’s check the status of the Skupper service:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>skupper service status
Services exposed through Skupper:
╰─ instructlab:8000 <span class="o">(</span>tcp<span class="o">)</span>
</pre></table></code></div></div><p>Now, we are almost ready to connect the two sites. The next step is to deploy the public Skupper in Site B and create a connection between the two sites.</p><h2 id="3-public-skupper-deployment"><span class="me-2">3. Public Skupper deployment</span><a href="#3-public-skupper-deployment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The third step is to deploy the public Skupper in Site B. The public Skupper will receive the connection from the private Skupper and create a secure connection between the two sites. Open a new terminal and run the following commands:</p><ol><li>Creating the project and deploying the public Skupper:</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>oc new-project ollama-pilot
skupper init <span class="nt">--enable-console</span> <span class="nt">--enable-flow-collector</span> <span class="nt">--console-user</span> admin <span class="nt">--console-password</span> admin 
</pre></table></code></div></div><ol><li>Creating the token to allow the private Skupper to connect to the public Skupper:</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>skupper token create token.yaml
</pre></table></code></div></div><p>At this point, you should have a <code class="language-plaintext highlighter-rouge">token.yaml</code> file with the token to connect the two sites. The next step is to link the two sites. For this, we will need to switch back to the terminal where the private Skupper is running.</p><h2 id="4-secure-communication-between-the-two-sites-with-skupper"><span class="me-2">4. Secure communication between the two sites with Skupper</span><a href="#4-secure-communication-between-the-two-sites-with-skupper" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The fourth step is to connect the two sites. In the terminal where the private Skupper is running, run the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>skupper <span class="nb">link </span>create token.yaml <span class="nt">--name</span> instructlab <span class="c"># Or any other name you want</span>
</pre></table></code></div></div><p>Let’s check the status of the Skupper link:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>skupper <span class="nb">link </span>status

Links created from this site:

        Link instructlab is connected

Current links from other sites that are connected:

        There are no connected links
</pre></table></code></div></div><blockquote><p>Before continuing, let’s hop back to the terminal where the public Skupper is running and check the status of the link:</p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>skupper <span class="nb">link </span>status

Links created from this site:

       There are no links configured or connected

Current links from other sites that are connected:

       Incoming <span class="nb">link </span>from site b8ad86d5-9680-4fea-9c07-ea7ee394e0bd
</pre></table></code></div></div><h2 id="5-chatbot-with-protected-data"><span class="me-2">5. Chatbot with protected data</span><a href="#5-chatbot-with-protected-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now the last part is to expose the service in the public Skupper and create the Ollama Pilot application.</p><ol><li>Still on the terminal where the public Skupper is running, run the following command to expose the service. With the following command, we will create a Skupper service that matches the service exposed by the private Skupper. This will end up creating a Kubernetes service that will be used by the Ollama Pilot application.</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>skupper service create instructlab 8000
</pre></table></code></div></div><ol><li>Exposing the service to the internet:</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>oc expose service instructlab
</pre></table></code></div></div><ol><li>Getting the public URL:</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>oc get route instructlab
NAME          HOST/PORT                                                              PATH   SERVICES      PORT       TERMINATION   WILDCARD
instructlab   instructlab-ollama-pilot.apps.your-cluster-url          instructlab   port8000                 None
</pre></table></code></div></div><ol><li>The last step is to create the Ollama Pilot application. The Ollama Pilot application will be responsible for sending the user input to the Instruct Lab chat model and receiving the response from the Merlinite-7b-lab-Q4_K_M.gguf model. The Ollama Pilot application will be able to send requests to the Instruct Lab chat model through the secure connection created by Skupper.</ol><p>You can repeat all the instructions in step <a href="#1-ai-model-deployment-with-instructlab">1. AI model deployment with InstructLab</a> to install the Instruct Lab chat model in Site B. The only difference is that you will not run the <code class="language-plaintext highlighter-rouge">ilab model serve</code> command because the Instruct Lab chat model is already running in Site A.</p><p>The Ollama Pilot application will be responsible for sending the user input to the Instruct Lab chat model and receiving the response from the Merlinite-7b-lab-Q4_K_M.gguf model. The Ollama Pilot application will be able to send requests to the Instruct Lab chat model through the secure connection created by Skupper.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>ilab model chat <span class="nt">--endpoint-url</span> http://instructlab-ollama-pilot.apps.your-cluster-url/v1/
╭─────────────────────────────────────────────── system ────────────────────────────────────────────────
│ Welcome to InstructLab Chat w/ MODELS/MERLINITE-7B-LAB-Q4_K_M.GGUF <span class="o">(</span><span class="nb">type</span> /h <span class="k">for </span><span class="nb">help</span><span class="o">)</span>
╰──────────────────────────────────────────────────────────────────────────────────────────────────────
<span class="o">&gt;&gt;&gt;</span>                     <span class="o">[</span>S][default]
</pre></table></code></div></div><h3 id="the-question"><span class="me-2">THE question:</span><a href="#the-question" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>Yes or No question. Don’t fool me. Is LeBron better than Jordan?</p></blockquote><p>Have fun with your new chatbot with protected data! If you don’t agree with the answer, you can always ask again and train your model, but King James is the best!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/skupper/">skupper</a>, <a href="/categories/instructlab/">instructlab</a>, <a href="/categories/chatbot/">chatbot</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/cloud/" class="post-tag no-text-decoration" >cloud</a> <a href="/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/tags/redhat/" class="post-tag no-text-decoration" >redhat</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> Esta postagem está licenciada sob <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> pelo autor.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Compartilhar</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Running%20local%20AI%20with%20Instruct%20Lab%20and%20Skupper%20-%20Rafael%20Zago&url=https%3A%2F%2Frafaelvzago.github.io%2Fposts%2Frunning-local-ai-with-instruct-lab%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Running%20local%20AI%20with%20Instruct%20Lab%20and%20Skupper%20-%20Rafael%20Zago&u=https%3A%2F%2Frafaelvzago.github.io%2Fposts%2Frunning-local-ai-with-instruct-lab%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Frafaelvzago.github.io%2Fposts%2Frunning-local-ai-with-instruct-lab%2F&text=Running%20local%20AI%20with%20Instruct%20Lab%20and%20Skupper%20-%20Rafael%20Zago" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copie o link" data-title-succeed="Link copiado com sucesso!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Atualizados recentemente</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/RTL-Linux/">Real-Time Linux: Uma Jornada de Baixa Latência</a><li class="text-truncate lh-lg"> <a href="/posts/protocolos-TCP-IP-o-inicio/">TCP/IP O início e a evolução</a><li class="text-truncate lh-lg"> <a href="/posts/running-local-ai-with-instruct-lab/">Running local AI with Instruct Lab and Skupper</a><li class="text-truncate lh-lg"> <a href="/posts/vim-motions/">Vim Motions: Navigating and Editing Code Efficiently</a><li class="text-truncate lh-lg"> <a href="/posts/workshop-skupper-patient-portal/">Workshop: Patient Portal, conectando um banco de dados a um cluster K8S com Skupper</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/redhat/">redhat</a> <a class="post-tag btn btn-outline-primary" href="/tags/cloud/">cloud</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/opensource/">opensource</a> <a class="post-tag btn btn-outline-primary" href="/tags/rafael/">rafael</a> <a class="post-tag btn btn-outline-primary" href="/tags/skupper/">skupper</a> <a class="post-tag btn btn-outline-primary" href="/tags/tecnologia/">tecnologia</a> <a class="post-tag btn btn-outline-primary" href="/tags/zago/">zago</a> <a class="post-tag btn btn-outline-primary" href="/tags/carreira/">carreira</a> <a class="post-tag btn btn-outline-primary" href="/tags/cd/">cd</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Conteúdo</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Leia também</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/workshop-skupper-patient-portal/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1719889200" data-df="DD/MM/YYYY" > 02/07/2024 </time><h4 class="pt-0 my-2">Workshop: Patient Portal, conectando um banco de dados a um cluster K8S com Skupper</h4><div class="text-muted"><p> Descrição Este workshop tem como objetivo apresentar o Red Hat Service Interconnect, uma solução de integração de aplicações que permite a comunicação entre diferentes sistemas de forma eficiente ...</p></div></div></a></article><article class="col"> <a href="/posts/RTL-Linux/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1734663600" data-df="DD/MM/YYYY" > 20/12/2024 </time><h4 class="pt-0 my-2">Real-Time Linux: Uma Jornada de Baixa Latência</h4><div class="text-muted"><p> Introdução Real-Time Linux (RTL) é uma extensão do kernel do Linux que transforma o sistema operacional em um ambiente de tempo real. Isso significa que, além de suas funcionalidades tradicionais,...</p></div></div></a></article><article class="col"> <a href="/posts/multicloud-com-skupper/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1664593200" data-df="DD/MM/YYYY" > 01/10/2022 </time><h4 class="pt-0 my-2">Criando uma rede de aplicativos multicloud com Skupper</h4><div class="text-muted"><p> Referências e tecnologias utilizadas: https://skupper.io https://minikube.sigs.k8s.io Repositório com os Códigos Qpid-dispatch ActiveMQ Kubectl Kubernetes MTLS Open-source Sku...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/vim-motions/" class="btn btn-outline-primary" aria-label="Anterior" ><p>Vim Motions: Navigating and Editing Code Efficiently</p></a> <a href="/posts/protocolos-TCP-IP-o-inicio/" class="btn btn-outline-primary" aria-label="Próximo" ><p>TCP/IP O início e a evolução</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/rafaelvzago">Rafael Zago</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Exceto onde indicado de outra forma, as postagens do blog neste site são licenciadas sob a Creative Commons Attribution 4.0 International (CC BY 4.0) License pelo autor." >Alguns direitos reservados.</span></p><p>Feito com <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando o tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/redhat/">redhat</a> <a class="post-tag btn btn-outline-primary" href="/tags/cloud/">cloud</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/opensource/">opensource</a> <a class="post-tag btn btn-outline-primary" href="/tags/rafael/">rafael</a> <a class="post-tag btn btn-outline-primary" href="/tags/skupper/">skupper</a> <a class="post-tag btn btn-outline-primary" href="/tags/tecnologia/">tecnologia</a> <a class="post-tag btn btn-outline-primary" href="/tags/zago/">zago</a> <a class="post-tag btn btn-outline-primary" href="/tags/carreira/">carreira</a> <a class="post-tag btn btn-outline-primary" href="/tags/cd/">cd</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">Uma nova versão do conteúdo está disponível.</p><button type="button" class="btn btn-primary" aria-label="Update"> atualização </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/pt.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/assets/js/dist/app.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-9J3YRPN8EN"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9J3YRPN8EN'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
